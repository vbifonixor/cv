---
import { type CollectionEntry, render, getEntry } from "astro:content";
import { CalendarIcon, MapPinIcon } from "@lucide/astro";
import { formatDateRange } from "@/utils/formatDateRange";

interface Props {
  id: CollectionEntry<"workExperiences">["id"];
}

const entry = await getEntry("workExperiences", Astro.props.id);

const { Content: EntryContent } = entry
  ? await render(entry)
  : { Content: null };

if (!entry || !EntryContent) {
  return null;
}

const { rangeStr, durationStr } = formatDateRange(
  entry.data.dateStart,
  entry.data.dateEnd,
);
---

<article
  class="col-span-full grid grid-cols-subgrid md:col-span-2 md:grid-cols-subgrid print:col-span-2 print:grid-cols-subgrid"
>
  <div
    class="row-start-2 flex h-full items-start justify-start gap-[2ch] place-self-start text-xs md:row-auto print:row-auto"
  >
    <div class="hidden h-full border-l-2 border-zinc-100 md:block print:block">
      <div
        class="mt-3.5 ml-[calc(--spacing(-1.25))] h-2.5 w-2.5 rounded-full bg-amber-900/45"
      >
      </div>
    </div>
    <div class="flex h-full flex-col gap-[1ch] pt-3">
      <div class="flex items-start justify-items-stretch gap-[1ch]">
        <span class="text-zinc-400"><CalendarIcon size={12} /></span>
        <span class="flex shrink basis-10/12 flex-col"
          ><span>{rangeStr}</span><span class="text-zinc-400"
            >{durationStr}</span
          ></span
        >
      </div>
      <div class="flex items-start justify-items-stretch gap-[1ch]">
        <span class="text-zinc-400"><MapPinIcon size={12} /></span>
        <span class="flex shrink basis-10/12 flex-col">
          {entry.data.location}
        </span>
      </div>
      <div
        class="mt-auto mb-5 flex items-start justify-items-stretch gap-[1ch]"
      >
        {
          entry.data.stack ? (
            <ul class="inline leading-4 text-zinc-300">
              {entry.data.stack.map((item) => (
                <>
                  <li class="inline-flex px-1 py-0.5 font-mono text-[0.6rem]">
                    {item}
                  </li>
                </>
              ))}
            </ul>
          ) : null
        }
      </div>
    </div>
  </div>
  <div class="py-3">
    <h1
      class="inline-flex items-center-safe gap-[1ch] font-mono text-base font-black"
    >
      <span
        class="text-amber-900 underline decoration-zinc-200 decoration-dashed decoration-1 underline-offset-4"
        >{entry.data.name}</span
      >
      <span class="border-l-2 border-zinc-200 pl-[1ch] font-normal decoration-0"
        >{entry.data.role}</span
      >
    </h1>
    <div
      class="prose prose-sm prose-strong:font-mono prose-ul:pl-0 prose-li:pl-0"
    >
      <EntryContent />
    </div>
  </div>
</article>
